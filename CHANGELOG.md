# 更新日志

所有重要变更都会记录在此文件中。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
版本号遵循 [语义化版本](https://semver.org/lang/zh-CN/)。

## [1.0.2] - 2025-02-10

### 新增 ✨
- **一键构建脚本**：提供 Windows 和 Linux/Mac 构建脚本，支持快速打包不同版本
- **智能文件命名**：构建输出文件自动包含版本号和 CPU 架构信息
  - APK 格式：`vaultsafe-1.0.2-arm64-v8a.apk`
  - AAB 格式：`vaultsafe-1.0.2-universal.aab`

### 优化 ⚡
- **APK 体积优化**：通过 ABI 过滤和代码混淆，APK 体积从 ~50MB 降至 ~20MB
- **构建流程优化**：添加循环菜单系统，可连续执行多个构建任务
- **用户体验提升**：构建脚本提供清晰的输出信息，包含构建结果和文件路径

### 修复 🐛
- **终端编码问题**：修复 Windows 批处理脚本中文乱码，统一使用 UTF-8 编码
- **构建脚本语法**：修复 shell 脚本中的语法错误（移除 Windows 特有的 goto/ errorlevel）

### 技术改进 🔧
- **ABI 配置优化**：仅打包 arm64-v8a 和 armeabi-v7a 两种最常见架构
- **Gradle 配置**：启用 minifyEnabled、shrinkResources 和 ProGuard 混淆
- **MultiDex 支持**：启用多 dex 支持大型应用

---

## [1.0.1] - 2025-02-05

### 新增 ✨
- **密码验证功能**：查看、复制、编辑密码时需要主密码验证
- **验证超时配置**：可在设置中配置密码验证的超时时间（10秒/30秒/1分钟/5分钟/15分钟）
- **自动迁移配置文件**：配置文件现在统一存储在 `vault_safe_data` 目录下
- **配置文件自动迁移**：应用启动时自动将旧位置的配置文件迁移到新目录

### 优化 ⚡
- **解锁性能优化**：使用 Isolate 在后台线程执行 PBKDF2 密钥派生，解决 UI 卡顿问题
- **密钥派生异步化**：100,000 次 PBKDF2 迭代不再阻塞主线程
- **文件存储结构**：所有应用数据（配置、数据库、日志）集中在一个目录下
- **用户体验提升**：解锁时加载指示器动画流畅，无卡顿

### 修复 🐛
- **更新服务错误处理**：改进在线更新功能的错误提示，添加友好的错误消息
- **空 URL 处理**：更新服务器未配置时优雅跳过检查，不报错
- **网络错误分类**：针对不同的网络错误提供更清晰的提示信息
- **配置加载逻辑**：修复配置文件路径问题，支持从旧位置自动迁移

### 技术改进 🔧
- **后台线程处理**：使用 Dart Isolate 避免主线程阻塞
- **安全性保持**：密钥派生仍使用 100,000 次 PBKDF2 迭代，安全性未降低
- **代码质量**：清理无效代码，移除未使用的导入和参数

### 文件变更 📁
- 所有应用数据现在存储在：`AppData/vault_safe_data/`
  - `app_config.yaml` - 配置文件（已迁移）
  - `passwords.db` - 密码数据库
  - `backups/` - 备份目录
  - `vaultsafe.log` - 日志文件

### 迁移说明 📦
从 1.0.0 版本升级的用户：
- 配置文件会自动从 `AppData/app_config.yaml` 迁移到 `AppData/vault_safe_data/app_config.yaml`
- 旧文件会在迁移后自动删除
- 无需手动操作，应用启动时自动完成迁移

---

## [1.0.0] - 2025-01-XX

### 初始发布 🎉
- **核心功能**
  - 主密码保护
  - 密码加密存储（AES-256-GCM）
  - PBKDF2 密钥派生（100,000 次迭代）
  - 生物识别解锁（指纹/Face ID）

- **密码管理**
  - 添加、编辑、删除密码
  - 密码分类管理
  - 搜索密码
  - 复制密码到剪贴板
  - 自动清除剪贴板（30秒）

- **同步功能**
  - 本地同步服务器
  - 多配置支持
  - 自定义数据目录

- **安全特性**
  - 自动锁定（可配置超时时间）
  - 密码强度检测
  - 密码生成器（可配置长度和字符类型）
  - 主密码验证

- **自动更新**
  - 桌面端自动更新检查
  - 可配置更新间隔

- **跨平台支持**
  - Windows
  - macOS
  - Linux
  - Android
  - iOS

---

## 版本说明

版本号格式：`主版本号.次版本号.修订号+构建号`

- **主版本号**：不兼容的 API 变更
- **次版本号**：向下兼容的功能性新增
- **修订号**：向下兼容的问题修复
- **构建号**：递增的构建编号

例如：`1.0.1+2` 表示版本 1.0.1，第 2 次构建
